main:
  params: [input]
  steps:
  - getSha:
      assign:
        - sha: ${input.commits[0].id}
      next: pendingGithub
  - pendingGithub:
      call: http.post
      args:
        url: https://australia-southeast1-cloud-pipeline-dev.cloudfunctions.net/notify-github
        body:
          sha: ${sha}
          repo: "workflow-cicd-demo"
          owner: "jgunnink"
          state: "pending"
          context: "Workflow CD"
          description: "Pipeline running..."
          workflowId: ${sys.get_env("GOOGLE_CLOUD_WORKFLOW_EXECUTION_ID")}
      next: succeedGithub
  - succeedGithub:
      call: http.post
      args:
        url: https://australia-southeast1-cloud-pipeline-dev.cloudfunctions.net/notify-github
        body:
          sha: ${sha}
          repo: "workflow-cicd-demo"
          owner: "jgunnink"
          state: "success"
          context: "Workflow CD"
          description: "Pipeline successful"
          workflowId: ${sys.get_env("GOOGLE_CLOUD_WORKFLOW_EXECUTION_ID")}

